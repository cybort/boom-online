var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.gameScene=new boom.GameScene,this.addChild(this.gameScene)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var boom;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.map=new t.Map,i.hero=new t.Hero,i.once(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(i,e),i.prototype.onAddToStage=function(){this.addChild(this.map),this.addChild(this.hero),this.lastTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.drawGameView,this),this.control=new t.RockerControl,this.addChild(this.control)},i.prototype.drawGameView=function(){var t=egret.getTimer(),e=1e3/(t-this.lastTime);this.lastTime=t,this.hero.draw(60/e)},i.prototype.onTouchStart=function(t){this.hero.runStart(t._status)},i.prototype.onTouchStop=function(){this.hero.runStop()},i}(egret.DisplayObjectContainer);t.GameScene=e,__reflect(e.prototype,"boom.GameScene")}(boom||(boom={}));var boom;!function(t){var e=function(t){function e(){var e=t.call(this)||this;e.speed=1,e.status="";var i=RES.getRes("baobao_json"),o=RES.getRes("baobao_png"),s=new egret.MovieClipDataFactory(i,o);return e.mcds={up:s.generateMovieClipData("up"),down:s.generateMovieClipData("down"),left:s.generateMovieClipData("left"),right:s.generateMovieClipData("right")},e.movieClipData=e.mcds.down,e.frameRate=48,e.gotoAndStop(1),e}return __extends(e,t),e.prototype.getSpped=function(){return this.speed},e.prototype.setSpped=function(t){this.speed=t},e.prototype.draw=function(t){var e=this.speed*t;switch(this.status){case"up":this.y-=e;break;case"down":this.y+=e;break;case"left":this.x-=e;break;case"right":this.x+=e}},e.prototype.runStart=function(t){this.status!=t&&(this.status=t,this.movieClipData=this.mcds[this.status],this.gotoAndPlay(1,-1))},e.prototype.runStop=function(){this.status="",this.stop()},e}(egret.MovieClip);t.Hero=e,__reflect(e.prototype,"boom.Hero")}(boom||(boom={}));var boom;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.url="resource/boom.tmx",this.request=new egret.HttpRequest,this.request.once(egret.Event.COMPLETE,this.onMapComplete,this),this.request.open(this.url,egret.HttpMethod.GET),this.request.send()},e.prototype.onMapComplete=function(t){var e=egret.XML.parse(t.currentTarget.response),i=new tiled.TMXTilemap(512,480,e,this.url);i.render(),this.addChild(i)},e}(egret.DisplayObjectContainer);t.Map=e,__reflect(e.prototype,"boom.Map")}(boom||(boom={}));var boom;!function(t){var e=function(t){function e(e,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1);var s=t.call(this,e,i,o)||this;return s._status="",s}return __extends(e,t),e}(egret.Event);e.START="START",e.STOP="STOP",t.ControlEvent=e,__reflect(e.prototype,"boom.ControlEvent")}(boom||(boom={}));var boom;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._radius=20,t._space=t._radius/2,t._status="",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(i,e),i.prototype.onAddToStage=function(e){var i=this.stage.stageHeight;this.up=new egret.Shape,this.up.x=3*this._radius+this._space,this.up.y=i-5*this._radius-this._space,this.up.graphics.beginFill(0,.5),this.up.graphics.lineStyle(2),this.up.graphics.drawCircle(0,0,this._radius),this.up.graphics.endFill(),this.up.touchEnabled=!0,this.down=new egret.Shape,this.down.x=3*this._radius+this._space,this.down.y=i-this._radius-this._space,this.down.graphics.beginFill(0,.5),this.down.graphics.lineStyle(2),this.down.graphics.drawCircle(0,0,this._radius),this.down.graphics.endFill(),this.down.touchEnabled=!0,this.left=new egret.Shape,this.left.x=this._radius+this._space,this.left.y=i-3*this._radius-this._space,this.left.graphics.beginFill(0,.5),this.left.graphics.lineStyle(2),this.left.graphics.drawCircle(0,0,this._radius),this.left.graphics.endFill(),this.left.touchEnabled=!0,this.right=new egret.Shape,this.right.x=5*this._radius+this._space,this.right.y=i-3*this._radius-this._space,this.right.graphics.beginFill(0,.5),this.right.graphics.lineStyle(2),this.right.graphics.drawCircle(0,0,this._radius),this.right.graphics.endFill(),this.right.touchEnabled=!0,this.addChild(this.up),this.addChild(this.down),this.addChild(this.left),this.addChild(this.right);var o=this;this.startEvent=new t.ControlEvent(t.ControlEvent.START),this.stopEvent=new t.ControlEvent(t.ControlEvent.STOP),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.handleTouch,this),this.up.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doUp,this),this.up.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.up.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),this.down.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doDown,this),this.down.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.down.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),this.left.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doLeft,this),this.left.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.left.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),this.right.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doRight,this),this.right.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.right.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),document.addEventListener("keydown",function(t){var e="";switch(t.keyCode){case 38:e="up";break;case 40:e="down";break;case 37:e="left";break;case 39:e="right"}return e!=o._status&&(o._status=e,o.commonDo()),!1}),document.addEventListener("keyup",function(t){o._status="",o.dispatchEvent(o.stopEvent)})},i.prototype.doUp=function(){this._status="up",this.commonDo()},i.prototype.doDown=function(){this._status="down",this.commonDo()},i.prototype.doLeft=function(){this._status="left",this.commonDo()},i.prototype.doRight=function(){this._status="right",this.commonDo()},i.prototype.commonDo=function(){this.startEvent._status=this._status,this.dispatchEvent(this.startEvent)},i.prototype.doStop=function(){this._status="",this.dispatchEvent(this.stopEvent)},i.prototype.handleTouch=function(t){console.log(t.target.x),console.log(t.target.y)},i}(egret.DisplayObjectContainer);t.GameControl=e,__reflect(e.prototype,"boom.GameControl")}(boom||(boom={}));var boom;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._in=new egret.Bitmap(RES.getRes("control_in_png")),e._out=new egret.Bitmap(RES.getRes("control_out_png")),e._in.visible=!1,e._out.visible=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new egret.Shape;e.graphics.beginFill(0,0),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.addChild(e),this.addChild(this._out),this.addChild(this._in),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchBegin=function(t){this._in.visible=!0,this._out.visible=!0;var e=this._in.width/2,i=this._out.width/2;this._in.x=t.stageX-e,this._in.y=t.stageY-e,this._out.x=t.stageX-i,this._out.y=t.stageY-i},e.prototype.onTouchMove=function(t){var e=this._in.width/2,i=this._out.x,o=this._out.y,s=t.stageX-e,n=t.stageY-e,r=Math.abs(Math.sqrt(Math.pow(i-s,2)+Math.pow(o-n,2)));if(r<this._out.width/2)this._in.x=s,this._in.y=n;else{var h=this._out.width/2,a=i+h,d=o+h,c=Math.atan2(n-o,s-i),p=a+e*Math.cos(c),u=d+e*Math.sin(c);this._in.x=p-e,this._in.y=u-e}},e.prototype.onTouchEnd=function(t){this._in.visible=!1,this._out.visible=!1},e}(egret.DisplayObjectContainer);t.RockerControl=e,__reflect(e.prototype,"boom.RockerControl")}(boom||(boom={}));var boom;!function(t){var e=function(){function t(){}return t}();t.GameHandle=e,__reflect(e.prototype,"boom.GameHandle")}(boom||(boom={}));