var boom;!function(t){var e=function(t){function e(){t.call(this),this.speed=1,this.status="";var e=RES.getRes("baobao_json"),i=RES.getRes("baobao_png"),s=new egret.MovieClipDataFactory(e,i);this.mcds={up:s.generateMovieClipData("up"),down:s.generateMovieClipData("down"),left:s.generateMovieClipData("left"),right:s.generateMovieClipData("right")},this.movieClipData=this.mcds.down,this.frameRate=48,this.gotoAndStop(1)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getSpped=function(){return this.speed},s.setSpped=function(t){this.speed=t},s.draw=function(t){var e=this.speed*t;switch(this.status){case"up":this.y-=e;break;case"down":this.y+=e;break;case"left":this.x-=e;break;case"right":this.x+=e}},s.runStart=function(t){this.status!=t&&(this.status=t,this.movieClipData=this.mcds[this.status],this.gotoAndPlay(1,-1))},s.runStop=function(){this.status="",this.stop()},e}(egret.MovieClip);t.Hero=e,egret.registerClass(e,"boom.Hero")}(boom||(boom={}));var boom;!function(t){var e=function(t){function e(){t.call(this),this.once(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(){this.url="resource/boom.tmx",this.request=new egret.HttpRequest,this.request.once(egret.Event.COMPLETE,this.onMapComplete,this),this.request.open(this.url,egret.HttpMethod.GET),this.request.send()},s.onMapComplete=function(t){var e=egret.XML.parse(t.currentTarget.response),i=new tiled.TMXTilemap(512,480,e,this.url);i.render(),this.addChild(i)},e}(egret.DisplayObjectContainer);t.Map=e,egret.registerClass(e,"boom.Map")}(boom||(boom={}));var boom;!function(t){var e=function(t){function e(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1),t.call(this,e,i,s),this._status=""}__extends(e,t);var i=(__define,e);i.prototype;return e.START="START",e.STOP="STOP",e}(egret.Event);t.ControlEvent=e,egret.registerClass(e,"boom.ControlEvent")}(boom||(boom={}));var boom;!function(t){var e=function(e){function i(){e.call(this),this._radius=20,this._space=this._radius/2,this._status="",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var s=(__define,i),o=s.prototype;return o.onAddToStage=function(e){var i=this.stage.stageHeight;this.up=new egret.Shape,this.up.graphics.beginFill(0,.5),this.up.graphics.lineStyle(2),this.up.graphics.drawArc(3*this._radius+this._space,i-5*this._radius-this._space,this._radius,0,2*Math.PI,!0),this.up.graphics.endFill(),this.up.touchEnabled=!0,console.log(this.up.x),this.down=new egret.Shape,this.down.graphics.beginFill(0,.5),this.down.graphics.lineStyle(2),this.down.graphics.drawArc(3*this._radius+this._space,i-this._radius-this._space,this._radius,0,2*Math.PI,!0),this.down.graphics.endFill(),this.down.touchEnabled=!0,this.left=new egret.Shape,this.left.graphics.beginFill(0,.5),this.left.graphics.lineStyle(2),this.left.graphics.drawArc(this._radius+this._space,i-3*this._radius-this._space,this._radius,0,2*Math.PI,!0),this.left.graphics.endFill(),this.left.touchEnabled=!0,this.right=new egret.Shape,this.right.graphics.beginFill(0,.5),this.right.graphics.lineStyle(2),this.right.graphics.drawArc(5*this._radius+this._space,i-3*this._radius-this._space,this._radius,0,2*Math.PI,!0),this.right.graphics.endFill(),this.right.touchEnabled=!0,this.addChild(this.up),this.addChild(this.down),this.addChild(this.left),this.addChild(this.right);var s=this;this.startEvent=new t.ControlEvent(t.ControlEvent.START),this.stopEvent=new t.ControlEvent(t.ControlEvent.STOP),this.up.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doUp,this),this.up.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.up.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),this.down.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doDown,this),this.down.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.down.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),this.left.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doLeft,this),this.left.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.left.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),this.right.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.doRight,this),this.right.addEventListener(egret.TouchEvent.TOUCH_END,this.doStop,this),this.right.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.doStop,this),document.addEventListener("keydown",function(t){var e="";switch(t.keyCode){case 38:e="up";break;case 40:e="down";break;case 37:e="left";break;case 39:e="right"}return e!=s._status&&(s._status=e,s.commonDo()),!1}),document.addEventListener("keyup",function(t){s._status="",s.dispatchEvent(s.stopEvent)})},o.doUp=function(){this._status="up",this.commonDo()},o.doDown=function(){this._status="down",this.commonDo()},o.doLeft=function(){this._status="left",this.commonDo()},o.doRight=function(){this._status="right",this.commonDo()},o.commonDo=function(){this.startEvent._status=this._status,this.dispatchEvent(this.startEvent)},o.doStop=function(){this._status="",this.dispatchEvent(this.stopEvent)},i}(egret.DisplayObjectContainer);t.GameControl=e,egret.registerClass(e,"boom.GameControl")}(boom||(boom={}));var boom;!function(t){var e=function(e){function i(){e.call(this),this.map=new t.Map,this.hero=new t.Hero,this.once(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var s=(__define,i),o=s.prototype;return o.onAddToStage=function(){this.addChild(this.map),this.addChild(this.hero),this.lastTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.drawGameView,this),this.control=new t.GameControl,this.control.addEventListener(t.ControlEvent.START,this.onTouchStart,this),this.control.addEventListener(t.ControlEvent.STOP,this.onTouchStop,this),this.addChild(this.control)},o.drawGameView=function(){var t=egret.getTimer(),e=1e3/(t-this.lastTime);this.lastTime=t,this.hero.draw(60/e)},o.onTouchStart=function(t){this.hero.runStart(t._status)},o.onTouchStop=function(){this.hero.runStop()},i}(egret.DisplayObjectContainer);t.GameScene=e,egret.registerClass(e,"boom.GameScene")}(boom||(boom={}));var boom;!function(t){var e=function(){function t(){}var e=(__define,t);e.prototype;return t}();t.GameHandle=e,egret.registerClass(e,"boom.GameHandle")}(boom||(boom={}));var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){this.gameScene=new boom.GameScene,this.addChild(this.gameScene)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");